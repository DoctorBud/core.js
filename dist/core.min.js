// Core JavaScript Tools
// (c) 2014, Mathigon / Philipp Legner
// MIT License (https://github.com/Mathigon/core.js/blob/master/LICENSE)

!function(){{var M={core:!0},a=Array.prototype.push,b=Array.prototype.slice,c=Array.prototype.shift;Array.prototype.join}"object"==typeof module&&"object"==typeof module.exports?(module.exports=M,global.M=M):"function"==typeof define&&define.amd?define(M):window.M=M,M.noop=function(){},M.trueop=function(){return!0},M.run=function(a,b,c){return a instanceof Function?a.apply(c||null,b):a},M.isOneOf=function(a){for(var b=1;b<arguments.length;++b)if(a===arguments[b])return!0;return!1},function(){function a(a,b,c){Object.defineProperty(a,b,{enumerable:!1,writable:!0,value:c})}M.object={},M.has=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},M.object.keys=Object.keys||function(a){var b=[];for(var c in a)M.has(a,c)&&b.push(c);return b},M.object.invert=function(a){for(var b={},c=M.keys(a),d=0,e=c.length;e>d;++d)b[a[c[d]]]=c[d];return b},M.object.create=Object.create||function(){function a(){}return function(b){return a.prototype=b,new a}}(),M.each=function(a,b){var c,d,e=a.length;if(0===e||e&&a.hasOwnProperty(e-1))for(c=[],d=0;e>d;++d)M.has(a,d)&&c.push(b(a[d],d));else{c={};for(d in a)M.has(a,d)&&(c[d]=b(a[d],d))}return c},M.some=function(a,b){var c,d,e=a.length;if(0===e||e&&a.hasOwnProperty(e-1)){for(c=0;e>c;++c)if(M.has(a,c)&&(d=b(a[c],c),void 0!==d))return d}else for(c in a)if(M.has(a,c)&&(d=b(a[c],c),void 0!==d))return d},M.extend=function(b,c,d){for(var e in c)M.has(c,e)&&(void 0===c[e]?delete b[e]:d?a(b,e,c[e]):b[e]=c[e])},M.merge=function(){for(var a={},b=0;b<arguments.length;++b)M.each(arguments[b],function(b,c){a[c]=b});return a},M.watch=function(a,b,c){var d=a[b],e=function(){return d},f=function(a){var b=d;return d=a,a=c.call(this,a,b)};delete a[b]&&Object.defineProperty(a,b,{get:e,set:f,enumerable:!0,configurable:!0})},M.unwatch=function(a,b){var c=a[b];delete a[b],a[b]=c}}(),function(){var a={},b=/\s([a-zA-Z]+)/;M.typeof=function(c){if(null==c)return""+c;if(M.isNaN(c))return"nan";var d=toString.call(c);return a[d]||(a[d]=d.match(b)[1].toLowerCase())},M.isType=function(a,b){return M.typeof(a)===b},M.isString=function(a){return a instanceof String||"string"==typeof a},M.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},M.isNumber=function(a){return a instanceof Number||"number"==typeof a},M.isInteger=function(a){return a%1===0},M.isDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)},M.isNaN=function(a){return a!==a},M.isFunction=function(a){return a instanceof Function},M.isBoolean=function(a){return a instanceof Boolean||"boolean"==typeof a},M.isObject=function(a){return a===Object(a)}}(),function(){function a(a){for(var b=0;b<c.length;++b)if(c[b][0]===a)return c[b][1];return null}function b(d){var e=typeof d;if(null==d||M.isOneOf(e,"number","string","boolean"))return d;if(d instanceof Number)return new Number(d.valueOf());if(d instanceof String)return new String(d.valueOf());if(d instanceof Boolean)return new Boolean(d.valueOf());if(d instanceof Date)return new Date(d.valueOf());if(d instanceof RegExp)return new RegExp(d);var f=a(d);if(f)return f;var g=d;if(M.isArray(d)){g=[],c.push([d,g]);for(var h=0,i=d.length;i>h;++h)g[h]=b(d[h])}else if(d instanceof Object){g={},c.push([d,g]);for(var j in d)M.has(d,j)&&(g[j]=b(d[j]))}return g}M.shallowCopy=function(a){var b=typeof a;return null==a||M.isOneOf(b,"number","string","boolean")?a:a instanceof Number?new Number(a.valueOf()):a instanceof String?new String(a.valueOf()):a instanceof Boolean?new Boolean(a.valueOf()):a instanceof Date?new Date(a.valueOf()):a instanceof RegExp?new RegExp(a):M.each(a,function(a){return a})};var c=[];M.deepCopy=function(a){c=[];var d=b(a);return c=[],d},M.shallowEquals=function(){},M.deepEquals=function(){}}(),function(){M.inherit=function(a,b){a.prototype=new b,a.prototype.constructor=this},M.Class=function(){this._events={},this._properties={},this._timeouts={}},M.extend(M.Class.prototype,{on:function(a,b){this._events[a]?this._events[a].has(b)||this._events[a].push(b):this._events[a]=[b]},off:function(a,b){if(this._events[a]){var c=this._events[a].indexOf(b);c>=0&&this._events.splice(c,1)}},trigger:function(a,b){if(this._events[a]){var c=this;M.each(this._events[a],function(a){a.call(c,b)})}},set:function(a,b){var c=this;this._properties[a]=b,window.clearTimeout(this._timeouts[a]),this._timeouts[a]=window.setTimeout(function(){c.trigger("_update_"+a,b)})},listen:function(a,b){this.on("_update_"+a,b)},get:function(a){return this._properties[a]}}),M.Class.extend=function(a){var b=this,c=function(){this._events={},this._properties={},this._timeouts={},a.init&&a.init.apply(this,arguments)};c.prototype={};for(var d in b.prototype)c.prototype[d]=b.prototype[d];for(d in a)"init"!==d&&(c.prototype[d]=a[d]);return c.extend=M.Class.extend,c.prototype.constructor=c,c.parent=b,c}}(),function(){M.extend(String.prototype,{strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},collapse:function(){return this.trim().replace(/\s+/g," ")},toTitleCase:function(){return this.replace(/\S+/g,function(a){return a.charAt(0).toUpperCase()+a.slice(1)})},words:function(){return this.strip().split(/\s+/)}},!0),String.prototype.endsWith||M.extend(String.prototype,{endsWith:function(a){var b=this.length,c=b-a.length;return this.substring(c,b)===a}},!0),String.prototype.contains||M.extend(String.prototype,{contains:function(){return-1!==String.prototype.indexOf.apply(this,arguments)}},!0)}(),function(){function d(a){return a.length}function e(a,c,d){if(!d.length)return M.run(a,c);for(var f=b.call(d,0),g=f.shift(),h=[],i=0;g>i;++i)h.push(e(a,c.concat([i]),f));return h}M.tabulate=function(a){var b=M.toArray(arguments);return c.call(b),e(a,[],b)},M.list=function(a,b,c){c||(c=1);var d,e=[];if(null==b&&a>=0)for(d=0;a>d;d+=c)e.push(d);else if(null==b)for(d=0;d>a;d-=c)e.push(d);else if(b>=a)for(d=a;b>=d;d+=c)e.push(d);else for(d=a;d>=b;d-=c)e.push(d);return e};var f=["undefined","null","number","boolean","string","function"];M.toArray=function(a){return f.has(M.typeof(a))?[a]:Array.prototype.slice.call(a,0)},M.map=function(a){var b=M.toArray(arguments);c.call(b);var e=Math.max.apply(Math,M.each(b,d));return M.tabulate(function(c){return a.apply(null,M.each(b,function(a){return a[c]}))},e)},M.concat=function(a,b){if(arguments.length>2){args=M.toArray(arguments);var c=args.pop();return M.concat(M.concat(args),c)}for(var d=Array.prototype.slice.call(a,0),e=0,f=b.length;f>e;++e)d.push(b[e]);return d},M.extend(Array.prototype,{each:function(a,b){var c,d=[],e=this.length;if(b)for(c=e-1;c>=0;--c)M.has(this,c)&&(d[c]=a(this[c],c));else for(c=0;e>c;++c)M.has(this,c)&&(d[c]=a(this[c],c));return d},has:function(a){return-1!==this.indexOf(a)},total:function(){for(var a=0,b=this.length,c=0;b>c;++c)a+=+this[c]||0;return a},first:function(){return this[0]},last:function(){return this[this.length-1]},min:function(){return Math.min.apply(Math,this)},max:function(){return Math.max.apply(Math,this)},range:function(){return[this.min(),this.max()]},clean:function(){for(var a=[],b=this.length,c=0;b>c;++c)null!=this[c]&&a.push(this[c]);return a},unique:function(){for(var a=[],b=this.length,c=0;b>c;++c)-1===a.indexOf(this[c])&&a.push(this[c]);return a},without:function(a){for(var b=[],c=this.length,d=0;c>d;++d)this[d]!==a&&b.push(this[d]);return b},chunk:function(b){for(var c=[],d=[],e=0,f=this.length,g=0;f>g;++g)d.push(this[g]),++e,e>=b&&(c.push(d),d=[],e=0);return d.length&&a.call(c,d),c},rotate:function(b){var c=this.length;b=(b%c+c)%c;var d=this.slice(0,b),e=this.slice(b);return a.apply(e,d),e},flatten:function(){for(var a=b.call(this,0);M.isArray(a[0]);){for(var c=[],d=0,e=a.length;e>d;++d)c=c.concat.apply(c,a[d]);a=c}return a},sortBy:function(a){return this.sort(function(b,c){return b[a]-c[a]})}},!0)}(),function(){M.Queue=function(){this._toResolve=0,this._flushing=!1,this._stack=[]},M.Queue.prototype.require=function(a){var b=this;this._toResolve+=1,a.call(this,function(){b._toResolve-=1,b._toResolve<=0&&b.flush()})},M.Queue.prototype.unrequire=function(){},M.Queue.prototype.timeout=function(a){this.require(function(b){setTimeout(function(){b()},a)})},M.Queue.prototype.untimeout=function(){},M.Queue.prototype.flush=function(){if(!this._flushing){this._flushing=!0;for(var a=0;a<this._stack.length;++a)this._stack[a]();this._stack=[],this._flushing=!1}},M.Queue.prototype.wait=function(a){this._flushing||this._toResolve<=0?a():this._stack.push(a)},M.Queue.prototype.unwait=function(){},M.Queue.prototype.clear=function(){}}()}();